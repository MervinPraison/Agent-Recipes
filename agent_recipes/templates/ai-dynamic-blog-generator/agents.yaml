framework: praisonai
topic: "{{topic}}"

# =============================================================================
# DYNAMIC BLOG POST GENERATOR - FULLY PARALLEL PIPELINE
# =============================================================================
# 
# A dynamic, parameterized recipe that adapts to any topic and style:
# 
# USAGE:
#   praisonai workflow run ai-dynamic-blog-generator/agents.yaml \
#     --var topic="AI Tools January 2026" \
#     --var style="coding" \
#     --var max_workers=4
#
# STYLE MODES:
#   - coding: Code examples, installation commands, practical implementation
#   - news: Breaking news format, quotes, statistics, timeline
#   - interactive: Diagrams, tables, bullet points, visual elements
#   - comprehensive: All of the above combined
#
# =============================================================================

# Variables with sensible defaults (override via CLI --var)
variables:
  topic: "AI Tools"
  today: "January 2026"
  style: "comprehensive"  # coding | news | interactive | comprehensive
  max_workers: 4
  wp_category: "AI"
  wp_author: "praison"
  keyword_count: 3
  search_results: 5

agents:
  # ═══════════════════════════════════════════════════════════════════════════
  # DUPLICATE CHECKER - Filters already-published topics
  # ═══════════════════════════════════════════════════════════════════════════
  duplicate_checker:
    role: Content Deduplication Agent
    goal: Filter topic list to only unique topics not yet published
    backstory: You check for duplicate content and return ALL unique topics as a JSON array.
    tools:
      - check_duplicate

  # ═══════════════════════════════════════════════════════════════════════════
  # KEYWORD GENERATOR - Creates search queries for research
  # ═══════════════════════════════════════════════════════════════════════════
  keyword_generator:
    role: Research Keyword Specialist
    goal: Generate comprehensive search keywords for in-depth topic research
    backstory: |
      You are an expert at generating diverse, specific search queries.
      You create keywords that will find unique, specific information.
      Generate queries that cover: official sources, technical details, and examples.

  # ═══════════════════════════════════════════════════════════════════════════
  # DEEP RESEARCHER - Gathers comprehensive facts
  # ═══════════════════════════════════════════════════════════════════════════
  deep_researcher:
    role: Investigative Technical Researcher
    goal: Conduct exhaustive research - search extensively, gather ALL facts
    backstory: |
      You are a thorough investigative researcher who leaves no stone unturned.
      tavily_search returns FULL PAGE CONTENT in raw_content field - use it!
      Extract EVERYTHING: dates, statistics, quotes, code, specifications.
      NEVER summarize prematurely - preserve all details for the writer.
    tools:
      - tavily_search

  # ═══════════════════════════════════════════════════════════════════════════
  # DYNAMIC CONTENT WRITER - Adapts to style parameter
  # ═══════════════════════════════════════════════════════════════════════════
  content_writer:
    role: Dynamic Content Writer and Developer Advocate
    goal: Write engaging, comprehensive blog posts that include ALL researched information
    backstory: |
      You MUST use correct Gutenberg block format where content is inside HTML tags.
      You write about ONE topic only - never combine multiple topics.
      You use British English (colour, centre, organisation).
      
      CRITICAL: Include ALL information from research - nothing should be lost!
      
      STYLE ADAPTATION (current: {{style}}):
      
      IF style = "coding":
        - Lead with code examples and installation commands
        - Include imports, usage examples, and practical implementation
        - Use code blocks extensively
        - Add inline code for function/class names
      
      IF style = "news":
        - Lead with the most important news/announcement
        - Include quotes from official sources
        - Add statistics and data points
        - Include timeline of events
        - Use blockquotes for citations
      
      IF style = "interactive":
        - Use tables for comparisons and specifications
        - Include bullet point lists for features
        - Add diagrams descriptions (Mermaid syntax if possible)
        - Use headers to create scannable structure
        - Include summary boxes
      
      IF style = "comprehensive":
        - Combine ALL above styles
        - Start with news/announcement
        - Include code examples
        - Add tables and diagrams
        - Use interactive elements throughout
      
      MANDATORY ELEMENTS (ALL STYLES):
      - Include EVERY fact from research
      - Use tables for any comparative data
      - Use bullet lists for features/specifications
      - Include all dates, versions, and statistics
      - Add code examples where relevant
      - Use blockquotes for official quotes
      
      TITLE RULES (SEO-CRITICAL):
      - Include SPECIFIC names: tool, library, framework, or version
      - NEVER use generic words like "Insights", "Findings", "Overview", "Guide"
      - GOOD: "LangChain 0.2 Agents Tutorial with Python Code Examples"

  # ═══════════════════════════════════════════════════════════════════════════
  # PUBLISHER - Publishes to WordPress
  # ═══════════════════════════════════════════════════════════════════════════
  publisher:
    role: WordPress Publisher
    goal: Validate and publish blog post to WordPress
    backstory: |
      You extract title and content from structured input and publish to WordPress.
      You validate that content is in Gutenberg block format.
    tools:
      - create_wp_post

steps:
  # ─────────────────────────────────────────────────────────────────────────────
  # STEP 1: Gather topics based on the provided topic parameter
  # ─────────────────────────────────────────────────────────────────────────────
  - include: ai-topic-gatherer

  # ─────────────────────────────────────────────────────────────────────────────
  # STEP 2: Filter duplicates (checks against existing WordPress posts)
  # ─────────────────────────────────────────────────────────────────────────────
  - name: filter_duplicates
    agent: duplicate_checker
    output_variable: unique_topics
    output_json:
      type: array
      items:
        type: object
        properties:
          title:
            type: string
          url:
            type: string
          content:
            type: string
    action: |
      {{previous_output}}
      
      For EACH topic from the list above:
      1. Call check_duplicate with the topic title
      2. If NOT a duplicate (status is UNIQUE), add to the unique list
      
      Return a JSON array of unique topics with their URLs and content.

  # ─────────────────────────────────────────────────────────────────────────────
  # STEPS 3-6: For EACH unique topic - research, write, publish (PARALLEL)
  # Each iteration has ISOLATED context - no cross-contamination
  # ─────────────────────────────────────────────────────────────────────────────
  - loop:
      over: unique_topics
      parallel: true
      max_workers: 4
    steps:
      # Step 3a: Generate keywords for THIS topic
      - name: generate_keywords
        agent: keyword_generator
        output_json:
          type: object
          properties:
            topic:
              type: string
            keywords:
              type: array
              items:
                type: string
        action: |
          TOPIC: {{item.title}}
          SOURCE: {{item.url}}
          CONTEXT: {{item.content}}
          
          Generate EXACTLY {{keyword_count}} specific search queries to research this topic.
          
          Include queries for:
          1. Official announcements and documentation (site:official-domain)
          2. Technical specifications, features, and capabilities
          3. Code examples, implementations, or tutorials

      # Step 3b: Research THIS topic EXHAUSTIVELY
      - name: deep_research
        agent: deep_researcher
        output_json:
          type: object
          properties:
            topic:
              type: string
            all_facts:
              type: array
              items:
                type: object
                properties:
                  category:
                    type: string
                  facts:
                    type: array
                    items:
                      type: string
            code_examples:
              type: array
              items:
                type: string
            statistics:
              type: array
              items:
                type: string
            quotes:
              type: array
              items:
                type: string
            sources:
              type: array
              items:
                type: string
        action: |
          TOPIC: {{previous_output.topic}}
          SEARCH KEYWORDS: {{previous_output.keywords}}
          
          Perform EXACTLY {{keyword_count}} searches using the keywords above.
          
          CRITICAL: Extract and preserve EVERYTHING from raw_content:
          
          1. ALL FACTS - Organize by category:
             - Features and capabilities
             - Technical specifications
             - Pricing and availability
             - Release dates and versions
             - Compatibility and requirements
          
          2. CODE EXAMPLES - Extract any:
             - Installation commands
             - Import statements
             - Usage examples
             - Configuration snippets
          
          3. STATISTICS - Extract all numbers:
             - Performance metrics
             - Pricing
             - User counts
             - Benchmarks
          
          4. QUOTES - Extract official statements:
             - Company announcements
             - Developer comments
             - Expert opinions
          
          5. SOURCES - Track all URLs for citations
          
          DO NOT SUMMARIZE - preserve all details for the writer!

      # Step 3c: Write the article with ALL collected information
      - name: write_article
        agent: content_writer
        output_json:
          type: object
          properties:
            title:
              type: string
            content:
              type: string
        action: |
          STYLE MODE: {{style}}
          
          RESEARCH DATA (include ALL of this in the article):
          {{previous_output}}
          
          Write a {{style}} blog post using Gutenberg blocks.
          
          MANDATORY STRUCTURE:
          
          1. INTRODUCTION (1-2 paragraphs)
             - What is this about?
             - Why does it matter?
          
          2. KEY FEATURES/ANNOUNCEMENTS (use table or bullet list)
             - Include ALL features from research
             - Use a comparison table if applicable
          
          3. TECHNICAL DETAILS (if style includes coding)
             - Installation commands in code blocks
             - Usage examples with full code
             - Configuration snippets
          
          4. STATISTICS & DATA (use table)
             - Include ALL numbers from research
             - Format as a clear table
          
          5. QUOTES & SOURCES (use blockquotes)
             - Include official quotes
             - Cite sources
          
          6. CONCLUSION
             - Summary of key points
             - What's next / implications
          
          GUTENBERG BLOCKS TO USE:
          - <!-- wp:paragraph --> for text
          - <!-- wp:heading --> for headers
          - <!-- wp:code --> for code blocks
          - <!-- wp:table --> for data tables
          - <!-- wp:list --> for bullet points
          - <!-- wp:quote --> for blockquotes
          - <!-- wp:separator --> for section breaks
          
          OUTPUT FORMAT:
          - title: SEO-optimized title (6-10 words, include tool/product name)
          - content: Full Gutenberg block formatted content with ALL research included

      # Step 3d: Publish to WordPress
      - name: publish_article
        agent: publisher
        action: |
          ARTICLE:
          Title: {{previous_output.title}}
          Content: {{previous_output.content}}
          
          Call create_wp_post with:
          - title: the title above
          - content: the content above
          - status: publish
          - category: {{wp_category}}
          - author: {{wp_author}}
          
          Report the post ID.

# Enable context management with truncation (backup safeguard)
context:
  enabled: true
  max_tool_output_tokens: 5000
